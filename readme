____________________________________________________________________________________________*
Στελιος Κοτανιδης                                                                           |
1115201300236                                                                               |
                                                                                            |
Εργασια 1                                                                                   |
                                                                                            |
Το προγραμμα υλοποιηθηκε σε περιβαλλον linux elementary OS, sublime text 2.                 |
Μεταγλωτιζεται ως gcc -o prodcons prodcons.c                                                |
./prodcons N K  η μεσω του makefile                                                         |
                                                                                            |
Ολος ο κωδικας βρισκεται σε ενα αρχειο στο prodcons.c , δεν χρειαζεται διαφορετικο .h       |
Γινεται χρηση της fork() για να δημιουργηθουν τα παιδια και χρησιμοποιουνται σεμαφοροι      |
για τον συγχρονισμο τους. Υπαρχουν 2 κομματια διαμοιραζομενης μνημης το οποιο το ενα        |
ανηκει στους Ρ και το αλλο στον Consumer. Οι 2 τυποι διεργασιας επικοινωνουν μεσω αυτης     |
της μνημης. Υπαρχουν συνολο 2 σεμαφοροι ενας για τους Ρ και ενας για τον Consumer.          |
Ο Consumer ανεβαζει τον σημαφοροι του Ρ κ οι Ρ του Consumer αντιστοιχα. Το θεμα του         |
συγχρονισμου υλοποιειται χωρις λαθη. Η διαμοιραζομενη μνημη εχει μεγεθος 256.               |
                                                                                            |
Το προγραμμα δεχεται 3 ορισματα: ονομα εκτελεσιμου, Ν, Κ.                                   |
Οι Ρ διαβαζουν απο ενα αρχειο blabla.txt που περιεχει 20 τυχαιες γραμμες.                   |
Μετραει τις γραμμες του αρχειου κ με χρηση της fseek ξεκιναει απο τον πρωτο χαρακτηρα.      |
Μπορει να προσαρμοστει για οποιοδηποτε αρχειο. Επειτα αρχικοποιουνται οι σημαφοροι με       |
τον Consumer να ξεκιναει στο 1 κ τον Ρ να ξεκιναει στο 0.                                   |
Μετα δηλωνεται η διαμοιραζομενη μνημη κ "σβηνει" οτι εγραφε πριν (χρησιμοποιηθηκε για       |
λογους debugging και το κρατησα γιατι μου φανηκε ωραια προσθηκη).                           |
Στη συνεχεια, σε μια for απο 0 μεχρι Ν δημιουργουνται παιδια με χρηση της fork().           |
Αν pid==0 τοτε ξερουμε οτι ειναι τα παιδια κ εκει μεσα υπαρχει ο κωδικας τους.              |
                                                                                            |
ΤΑ ΠΑΙΔΙΑ:                                                                                  |
Παιρνουν τυχαιες γραμμες απο το αρχειο με βαση τον χρονο συστηματος κ αποφευγεται           |
να ληφθει μηδενικη γραμμη. Μετα κατεβαζουμε το σημαφορο των παιδιων για να γραψουν          |
στην διαμοιραζομενη μνημη. Σε μια συμβολοσειρα γραφεται το pid, σε μια αλλη το κειμενο      |
και επειτα ενωνονται σε μια μεγαλυτερη συμβολοσειρα που γραφεται πανω στην διαμοιραζομενη.  |
                                                                                            |
Ελεγχουν το κειμενο που επιστρεφει ο Consumer, εκτυπωνουν το κειμενο κ το δικο τους pid.    |
Αν ειναι ιδιο σημαινει οτι αυτη η διεργασια ειχε δωσει το κειμενο οποτε αυξανεται η         |
μεταβλητη pid_match. Ελεγχουν αν λαβουν το μηνυμα $$$ που σημαινει οτι πρεπει να κλεισουν.  |
Ανεβαινει ο σημαφορος του Consumer για να γραψει στην διαμοιραζομενη. Με την εξοδο τους     |
περναει το pid_match στην wait.                                                             |
                                                                                            |
Consumer:                                                                                   |
Τρεχει για Κ+Ν φορες για να μεταδωσει κ τα μηνυματα τερματισμου. Κατεβαινει ο               |
σημαφορος μεχρι να παρει αδεια απο τους Ρ για να συνεχισει. Γραφει απο την κυρια            |
μνημη σε μια προσωρινη συμβολοσειρα και κανει καθε χαρακτηρα κεφαλαιο με χρηση              |
της toupper(). Οταν ξεπεραστουν οι επαναληψεις των Ρ στελνει μηνυμα τερματισμου $$$         |
που το βλεπουν ολες οι διεργασιες μεσω της διαμοιραζομενης μνημης. Τελος ανεβαζει           |
τον σημαφορο των Ρ.                                                                         |
                                                                                            |   
Επειτα, η κυρια διεργασια περιμενει να παιδια να τερματισουν κ κραταει τις τιμες τους.      |
Προσθετει το συνολο κ εκτυπωνει την τιμη της καθε διεργασιας ξεχωριστα. Εγινε μετατροπη     |
απο δεκαδικο κατα 8μπιτς με τη χρηση του >>8 για να δειχνει τον σωστο αριθμο.               |
                                                                                            |
Τελος, κανω detach shared memory κ shmctl κ semctl για την αποδεσμευση των πορων.           |
                                                                                            |
bug: η πρωτη εκτυπωση του Ρ ειναι κενη, στο putty βγαζει παραπανω κενες εκτυπωσεις μεχρι    |
καθε διεργασια να παρει πισω το μηνυμα ενω στο λαπτοπ μου παιζει τελεια. Επισης πεταει      |
shmctl operation not permitted στο putty.                                                   |
____________________________________________________________________________________________*














